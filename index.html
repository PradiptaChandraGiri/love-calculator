<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #ffe6e6;
            padding: 20px;
        }

        h1 {
            color: #ff3366;
        }

        input {
            padding: 10px;
            margin: 10px;
            border: 2px solid #ff99aa;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #ff3366;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #dashboard,
        #result,
        #shareableLink,
        #dashboardLink {
            margin-top: 20px;
        }

        table {
            margin: 20px auto;
            border-collapse: collapse;
            width: 90%;
            max-width: 600px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>

<body>
    <h1>üíò Love Calculator üíò</h1>
    <div id="inputSection">
        <input type="text" id="name1" placeholder="Your Name">
        <input type="text" id="name2" placeholder="Crush's Name">
        <br>
        <button onclick="calculateLove()">Calculate Love %</button>
    </div>

    <div id="result"></div>
    <div id="shareableLink"></div>
    <div id="dashboardLink"></div>

    <div id="dashboard" style="display: none;">
        <h2>Your Love Dashboard üíñ</h2>
        <input type="text" id="nameFilter" placeholder="Filter by Name">
        <input type="date" id="dateFilter">
        <table>
            <thead>
                <tr>
                    <th>Your Name</th>
                    <th>Crush's Name</th>
                    <th>Love %</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="logBody"></tbody>
        </table>
    </div>

    <script>
        const queryParams = new URLSearchParams(window.location.search);
        const refName = queryParams.get("ref");
        const dashboardName = queryParams.get("dashboard");

        const inputSection = document.getElementById("inputSection");
        const resultDiv = document.getElementById("result");
        const dashboard = document.getElementById("dashboard");
        const logBody = document.getElementById("logBody");

        inputSection.style.display = "block";

        function calculateLove() {
            const name1 = document.getElementById("name1").value.trim();
            const name2 = document.getElementById("name2").value.trim();

            if (!name1 || !name2) {
                alert("Please enter both names!");
                return;
            }

            const loveScore = Math.floor(Math.random() * 41) + 60; // 60-100%
            const today = new Date().toISOString().split("T")[0];
            resultDiv.innerText = `${name1} ‚ù§Ô∏è ${name2} = ${loveScore}%`;

            const owner = refName || localStorage.getItem("ownerName") || name1;
            const logs = JSON.parse(localStorage.getItem("loveLogs") || "[]");
            logs.push({ owner, name1, name2, loveScore, date: today });
            localStorage.setItem("loveLogs", JSON.stringify(logs));

            if (refName) {
                resultDiv.innerText += "\nSaved privately.";
            } else {
                localStorage.setItem("ownerName", name1);
                const baseUrl = window.location.origin + window.location.pathname;
                document.getElementById("shareableLink").innerHTML =
                    `üîó Share this link with your crush:<br><strong>${baseUrl}?ref=${encodeURIComponent(name1)}</strong>`;
                document.getElementById("dashboardLink").innerHTML =
                    `üìä View your private dashboard here:<br><strong>${baseUrl}?dashboard=${encodeURIComponent(name1)}</strong>`;
            }
        }

        function renderLogs(logs) {
            logBody.innerHTML = "";
            logs.forEach(log => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${log.name1}</td>
                    <td>${log.name2}</td>
                    <td>${log.loveScore}%</td>
                    <td>${log.date}</td>
                `;
                logBody.appendChild(row);
            });
        }

        if (dashboardName && localStorage.getItem("ownerName") === dashboardName) {
            dashboard.style.display = "block";
            const logs = JSON.parse(localStorage.getItem("loveLogs") || "[]")
                .filter(log => log.owner === dashboardName);
            renderLogs(logs);

            document.getElementById("nameFilter").addEventListener("input", function () {
                const filterVal = this.value.toLowerCase();
                const filtered = logs.filter(log => log.name1.toLowerCase().includes(filterVal));
                renderLogs(filtered);
            });

            document.getElementById("dateFilter").addEventListener("change", function () {
                const dateVal = this.value;
                const filtered = logs.filter(log => log.date === dateVal);
                renderLogs(filtered);
            });
        }
    </script>
</body>

</html>
